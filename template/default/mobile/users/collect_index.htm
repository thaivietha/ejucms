<!DOCTYPE html>
<html lang="zh-CN">
{include file="users/header" /}
<body style="padding-top:2.625rem ;">

{include file="users/rightNav" /}

<!--列表操作-->

<!--列表-->
<div class="fang_list  layui-form">
    {empty name="list"}
    没有符合条件的数据
    {else /}
    {foreach name="list" item="vo" key="k" }
    <div class="fang_item">
        <div class="fang_t">
            <div class="fang_t_l">
                <input type="checkbox" name="ids[]" value="{$vo.aid}" lay-filter="ids" lay-skin="primary"/>
            </div>
            <div class="fang_t_r">
                {$vo.add_time|date="Y-m-d H:i:s",###}
            </div>
        </div>
        <div class="fang_c">
            <div class="fang_c_l">
                <img src="{$vo.litpic}" >
            </div>
            <div class="fang_c_c">
                <span>{$vo.title}</span>
                <span>{$vo.province_name}{notempty name="$vo.city_name"}-{$vo.city_name}{/notempty}{notempty name="$vo.area_name"}-{$vo.area_name}{/notempty}</span>
                <span></span>
            </div>
            <div class="fang_c_r" style="width: 5.75rem;">
                <a onclick="cancelfun(this)" data-url="{:url('api/Ajax/collect_change')}" data-id="{$vo.aid}"  class="layui-btn btn-edit" >
                    取消收藏
                </a>
            </div>
        </div>
    </div>
    {/foreach}
    {/empty}
    {$page}
</div>
<script>
    layui.config({
        base: '__SKIN__/' //静态资源所在路径
        ,version: '{$version}'
    }).extend({
        index: 'lib/index' //主入口模块
    }).use(['index', 'table', 'element'], function() {
        var $ = layui.$,
            form = layui.form,
            layer = layui.layer,
            element = layui.element,
            table = layui.table;

        // 监听复选框全选
        form.on('checkbox(checkAll)', function(data){
            console.log(data.elem.checked);
            if (data.elem.checked) {
                $('.checkAll').attr('checked', true);
                $('input[name*=ids]').attr('checked', true);
            } else {
                $('.checkAll').attr('checked', false);
                $('input[name*=ids]').attr('checked', false);
            }
            form.render('checkbox');
        });

        // 监听每行复选框
        form.on('checkbox(ids)', function(data){
            console.log(data.elem.checked);
            if (data.elem.checked && $('input[name*=ids]:checked').length == $('input[name*=ids]').length) {
                $('.checkAll').attr('checked', true);
            } else {
                $('.checkAll').attr('checked', false);
            }
            form.render('checkbox');
        });
    });
    //取消收藏
    function cancelfun(obj) {
        layer.msg(false, {
            btnAlign: 'c'
            ,time: 0
            ,btn: ['确定', '不了']
            ,yes: function(index, layero){
                layer_loading();
                var url = $(obj).attr('data-url');
                $.ajax({
                    type : 'POST',
                    url : url,
                    data : {aid:$(obj).attr('data-id'), _ajax:1},
                    dataType : 'json',
                    success : function(res){
                        layer.closeAll();
                        if(res.code == 1){
                            layer.msg(res.msg, {icon: 1},function () {
                                window.location.reload();
                            });
                        }else{
                            showErrorAlert(res.msg);
                        }
                    },
                    error:function(){
                        layer.closeAll();
                        showErrorAlert();
                    }
                });
                return false;
            }
            ,btn2: function(index, layero){
                layer.close(index);
            }
        });
    }
</script>

<script type="text/javascript">
    //顶部右侧导航按钮
    $(".menuBox .icon-gengduo").on("click",function(){
        $(".rightNav").show();
        $(".menuBox .icon-gengduo").hide();
        $(".menuBox .icon-guanbi").show();
        $(".zhezhao").show();
    })
    $(".menuBox .icon-guanbi").on("click",function(){
        $(".rightNav").hide();
        $(".menuBox .icon-gengduo").show();
        $(".menuBox .icon-guanbi").hide();
        $(".zhezhao").hide();
    })
</script>
</body>
</html>
