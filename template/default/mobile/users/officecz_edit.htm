<!DOCTYPE html>
<html lang="zh-CN">
{include file="users/header" /}
<body style="padding-top:2.625rem ;">
<!--<script type="text/javascript" src="__PUBLIC__/plugins/Ueditor/ueditor.config.js?v={$version}"></script>-->
<!--<script type="text/javascript" src="__PUBLIC__/plugins/Ueditor/ueditor.all.js?v={$version}"></script>-->
<!--<script type="text/javascript" src="__PUBLIC__/plugins/Ueditor/lang/zh-cn/zh-cn.js?v={$version}"></script>-->
{include file="users/rightNav" /}
<form id="post_form" action="{:url('Officecz/edit')}" onsubmit="return false;">
    <!--添加房源信息-->
    <div class="fang_add mt10">
        {notempty name="$channelJoin"}
        <div class="item">
            <div class="item_l">{notempty name="$channelOrigin.join_must"}<b>*</b>{/notempty}关联{$channelJoin.ntitle}：</div>
            <div class="item_r">
                <input type="hidden" id="joinaid" name="joinaid" value="{$field.joinaid}" />
                <input type="text" name="join_title" id="join_title"  placeholder="丰祥花苑"  value="{$join_title}"/>
                <div class="input_div" id="input_div" style="display: none">
                </div>
            </div>
        </div>
        <script>
            var data_obj;
            $(function (){
                var searchurl = "{$searchurl}";
                autoSearch("join_title");
                function autoSearch(searchId) {
                    $("#" + searchId).autocomplete({
                        delay:300,      //触发时间
                        minLength:1,    //最小触发长度
                        source: function (request, response) {
                            $.ajax({
                                async: false,   //调用方式：同步
                                type: "POST",
                                url: searchurl,
                                dataType: "json",
                                data: {
                                    "keywords": request.term
                                },
                                success: function (data) {
                                    $(".input_div").empty();
                                    if (data.constructor === Object){
                                        data_obj = data;
                                        $.map(data,function (item,i) {
                                            var span = $('<span onclick="select_soption(this)" class="soption" data-id="'+i+'">'+item.title+'</span>');
                                            $(".input_div").append(span);
                                        });
                                        $(".input_div").show();
                                    }else{      //获取到空数据
                                        $(".input_div").hide();
                                    }
                                }
                                ,error:function (data) {
                                }
                            });
                        }
                    });
                }
            });
            function select_soption(obj) {
                var aid = $(obj).data('id');
                $("#joinaid").val(aid);
                $("#title").val(data_obj[aid]['title']);
                $("#join_title").val(data_obj[aid]['title']);
                $("#province_id").val(data_obj[aid]['province_id']);
                $("#city_id").val(data_obj[aid]['city_id']);
                $("#area_id").val(data_obj[aid]['area_id']);
                var map = "";
                if (data_obj[aid]['lng'] && data_obj[aid]['lat']){
                    map =  data_obj[aid]['lng']+","+data_obj[aid]['lat'];
                }
                $("#map").val(map);
                $("#address").val(data_obj[aid]['address']);
                $("#building_age").val(data_obj[aid]['building_age']);
                $("#property").val(data_obj[aid]['property']);

                $("#input_div").empty();
                $("#input_div").hide();

                set_city_list(data_obj[aid]['city_id']);
                set_area_list(data_obj[aid]['area_id']);
            }

        </script>
        {/notempty}
        <div class="item">
            <div class="item_l">{notempty name="$addonFieldExtList.province_id.ifrequire"}<b>*</b>{/notempty}所属区域：</div>
            <div class="item_r">
                <select name="province_id" id="province_id" onchange="province_ch()">
                    <option value="">省份</option>
                    {eju:volist name=':get_province_list()' id='vo'}
                    <option value="{$vo.id}" {eq name="$field.province_id" value="$vo.id" } selected {/eq}>{$vo.name}</option>
                    {/eju:volist}
                </select>
                <select name="city_id" id="city_id"  onchange="city_ch()">
                    <option value="">城市</option>
                </select>
                <select name="area_id" id="area_id">
                    <option value="">区域</option>
                </select>
            </div>
        </div>
        <div class="item">
            <div class="item_l">{notempty name="$addonFieldExtList.address.ifrequire"}<b>*</b>{/notempty}{$addonFieldExtList['address']['title']}：</div>
            <div class="item_r">
                <input type="text" name="addonFieldSys[address]" id="address" value="{$addonFieldExtList['address']['dfvalue']}"  placeholder="{$addonFieldExtList['address']['remark']}"/>
            </div>
        </div>
        <div class="item">
            <div class="item_l">{notempty name="$addonFieldExtList.title.ifrequire"}<b>*</b>{/notempty}房源标题：</div>
            <div class="item_r">
                <input type="text"  name="title" id="title"  placeholder="{$addonFieldExtList['title']['remark']}"  value="{$field.title}" />
            </div>
        </div>
        {notempty name="$addonFieldExtList['total_price']['ifeditable']"}
        <div class="item"  >
            <div class="item_l">{notempty name="$addonFieldExtList.total_price.ifrequire"}<b>*</b>{/notempty}{$addonFieldExtList['total_price']['title']}：</div>
            <div class="item_r">
                <input type="text" name="addonFieldSys[total_price]"  id="total_price" value="{$addonFieldExtList['total_price']['dfvalue']}" onkeyup="this.value=this.value.replace(/[^0-9.]/g,'');" onpaste="this.value=this.value.replace(/[^0-9.]/g,'');" placeholder="{$addonFieldExtList['total_price']['remark']}" />
            </div>
            <div  class="item_r" {empty name="$addonFieldExtList['price_units']['ifeditable']"}style="display:none;"{/empty}>
                <select name="addonFieldSys[price_units]" id="price_units">
                    {volist name="$addonFieldExtList['price_units']['dfvalue']" id="v2"}
                    <option value="{$v2}" {if condition="isset($addonFieldExtList['price_units']['trueValue']) AND in_array($v2, $addonFieldExtList['price_units']['trueValue'])"}selected{/if}>{$v2}</option>
                    {/volist}
                </select>
            </div>
        </div>
        {/notempty}
    {notempty name="$addonFieldExtList['area']['ifeditable']"}
    <div class="item">
        <div class="item_l">{notempty name="$addonFieldExtList.area.ifrequire"}<b>*</b>{/notempty}{$addonFieldExtList['area']['title']}：</div>
        <div class="item_r">
            <input type="text" name="addonFieldSys[area]" id="area" value="{$addonFieldExtList['area']['dfvalue']}"  onkeyup="this.value=this.value.replace(/[^0-9.]/g,'');" onpaste="this.value=this.value.replace(/[^0-9.]/g,'');"  placeholder="{$addonFieldExtList['area']['remark']}" />
        </div>
        <div class="item_unit">{$addonFieldExtList['area']['dfvalue_unit']}</div>
    </div>
    {/notempty}
    {notempty name="$addonFieldExtList['area']['ifeditable']"}
    <div class="item">
        <div class="item_l">{notempty name="$addonFieldExtList.floo_type.ifrequire"}<b>*</b>{/notempty}{$addonFieldExtList['floo_type']['title']}：</div>
        <div class="item_r">
            <select name="addonFieldSys[floo_type]" id="floo_type" >
                {volist name="$addonFieldExtList['floo_type']['dfvalue']" id="v2"}
                <option value="{$v2}" {if condition="isset($addonFieldExtList['floo_type']['trueValue']) AND in_array($v2, $addonFieldExtList['floo_type']['trueValue'])"}selected{/if}>{$v2}</option>
                {/volist}
            </select>
            <span>
                    总共
                    <input  class="w80 tc" type="text" name="addonFieldSys[floor_count]" id="floor_count" value="{$addonFieldExtList['floor_count']['dfvalue']}" onkeyup="this.value=this.value.replace(/[^0-9]/g,'');" onpaste="this.value=this.value.replace(/[^0-9]/g,'');">
                    层
                </span>
        </div>
    </div>
    {/notempty}
    {notempty name="$addonFieldExtList['building_age']['ifeditable']"}
    <div class="item">
        <div class="item_l">{notempty name="$addonFieldExtList.building_age.ifrequire"}<b>*</b>{/notempty}{$addonFieldExtList['building_age']['title']}：</div>
        <div class="item_r">
            <input type="text" name="addonFieldExt[building_age]" id="building_age" onkeyup="this.value=this.value.replace(/[^0-9]/g,'');" onpaste="this.value=this.value.replace(/[^0-9]/g,'');" value="{$addonFieldExtList['building_age']['dfvalue']}"  placeholder="{$addonFieldExtList['building_age']['remark']}" />
        </div>
        <div class="item_unit">{$addonFieldExtList['building_age']['dfvalue_unit']}</div>
    </div>
    {/notempty}
    {notempty name="$addonFieldExtList['property']['ifeditable']"}
    <div class="item">
        <div class="item_l">{notempty name="$addonFieldExtList.property.ifrequire"}<b>*</b>{/notempty}{$addonFieldExtList['property']['title']}：</div>
        <div class="item_r">
            <input type="text" name="addonFieldExt[property]" id="property" onkeyup="this.value=this.value.replace(/[^0-9]/g,'');" onpaste="this.value=this.value.replace(/[^0-9]/g,'');" placeholder="{$addonFieldExtList['property']['remark']}"  value="{$addonFieldExtList['property']['dfvalue']}" />
        </div>
        <div class="item_unit">{$addonFieldExtList['property']['dfvalue_unit']}</div>
    </div>
    {/notempty}
    {notempty name="$addonFieldExtList['property_fee']['ifeditable']"}
    <div class="item">
        <div class="item_l">{notempty name="$addonFieldExtList.property_fee.ifrequire"}<b>*</b>{/notempty}{$addonFieldExtList['property_fee']['title']}：</div>
        <div class="item_r">
            <input type="text" name="addonFieldExt[property_fee]" id="property_fee" value="{$addonFieldExtList['property_fee']['dfvalue']}"   placeholder="{$addonFieldExtList['property_fee']['remark']}" />
        </div>
        <div class="item_unit">{$addonFieldExtList['property_fee']['dfvalue_unit']}</div>
    </div>
    {/notempty}
    {notempty name="$addonFieldExtList['sale_name']['ifeditable']"}
    <div class="item">
        <div class="item_l">{notempty name="$addonFieldExtList.sale_name.ifrequire"}<b>*</b>{/notempty}{$addonFieldExtList['sale_name']['title']}：</div>
        <div class="item_r">
            <input type="text" name="addonFieldSys[sale_name]" id="sale_name" value="{$users.true_name}"   placeholder="{$addonFieldExtList['sale_name']['remark']}" />
        </div>
    </div>
    {/notempty}
    {notempty name="$addonFieldExtList['sale_phone']['ifeditable']"}
    <div class="item">
        <div class="item_l">{notempty name="$addonFieldExtList.sale_phone.ifrequire"}<b>*</b>{/notempty}{$addonFieldExtList['sale_phone']['title']}：</div>
        <div class="item_r">
            <span><input type="text" name="addonFieldSys[sale_phone]" id="sale_phone" value="{$users.mobile}"   placeholder="{$addonFieldExtList['sale_phone']['remark']}"  /></span>
            {notempty name="$addonFieldExtList['phone_code']['ifeditable']"}
            <span>转</span>
            <span><input class="w80 tc" type="text" name="addonFieldSys[phone_code]" id="phone_code"  placeholder="{$addonFieldExtList['phone_code']['remark']}" value="{$addonFieldExtList['phone_code']['dfvalue']}"/></span>
            {/notempty}
        </div>
    </div>
    {/notempty}
    <div class="item" style="border: 0;">
        <div class="item_l">缩略图：</div>
        <div class="item_r">
            <div class="upload">
                <img style="width: 36px;height: 36px;margin-right: 20px;" id="img_litpic" src="{$field.litpic|get_default_pic=###}">
                <span style="position: unset;" class="upload_bt test-upload-demoMore"  lay-data="{number:1,ey_inputId:'litpic',ey_savepath:'allimg'}">上传图片</span>
                <input type="hidden" name="litpic" id="litpic" placeholder="图片地址" value="{$field.litpic|default=''}">
            </div>
        </div>
    </div>
    <div class="item" style="border: 0;">
        <div class="item_l">效果图：</div>
        <div class="item_r">
            <div class="upload">
                <!--<input type="file" name="" id="" value="" />-->
                <span class="upload_bt multi-upload-demoMore"  lay-data="{number:100,ey_savepath:'allimg',ey_callbefore:'ershou_photo_upload()',ey_callback:'ershou_photo_upload_call_back'}">上传图片</span>
            </div>
        </div>
    </div>
    <div class="upload-img">
        {volist name="photo_list" id="vo" key="k"}
        <div class="item-img images-upload">
            <img src="{$vo.photo_pic}">
            <input type="hidden" name="photo_id[]" value="{$vo.photo_id}">
            <input type="hidden" name="photo_pic[]" value="{$vo.photo_pic}">
            <input type="hidden" name="photo_title[]" value="{$vo.photo_title}">
            <a href="javascript:void(0);" onclick="ClearPicArr(this,'{$vo.photo_pic}')">删除</a>
        </div>
        {/volist}
        <div class="images-upload" style="display: none;"></div>
        <div class="images_upload_tpl" style="display: none;">
            <div class="item-img images-upload">
                <img src="__STATIC__/admin/images/add-button.jpg" >
                <input type="hidden"/>
                <input type="hidden"/>
                <input type="hidden"/>
                <a href="javascript:void(0);">删除</a>
            </div>
        </div>
    </div>
    </div>
    <!--展开更多-->
    <div class="more-item mt10">
        <div class="more-down">【点击展开】选填部分，建议填写</div>
    </div>
    <!--添加更多房源信息-->
    <div class="fang_add mt10 fang_more">
        <div class="item">
            <div class="item_l">{notempty name="$addonFieldExtList.lng.ifrequire"}<b>*</b>{/notempty}地图坐标：</div>
            <div class="item_r">
                <input type="text" name="map" id="map" placeholder="115.345,22.1349" value="{$map}"/>
            </div>
            <div class="item_bt"><button class="bt-green" type="button" onclick="set_map()" >获取坐标</button></div>
        </div>
        {notempty name="$addonFieldExtList['fitment']['ifeditable']"}
        <div class="item">
            <div class="item_l">{notempty name="$addonFieldExtList.fitment.ifrequire"}<b>*</b>{/notempty}{$addonFieldExtList['fitment']['title']}：</div>
            <div class="item_r">
                <select  name="addonFieldSys[{$addonFieldExtList['fitment']['name']|default=''}]">
                    {volist name="$addonFieldExtList['fitment']['dfvalue']" id="v2"}
                    <option value="{$v2}" {if condition="isset($addonFieldExtList['fitment']['trueValue']) AND in_array($v2, $addonFieldExtList['fitment']['trueValue'])"}selected{/if}>{$v2}</option>
                    {/volist}
                </select>
            </div>
        </div>
        {/notempty}
        {notempty name="$addonFieldExtList['level']['ifeditable']"}
        <div class="item">
            <div class="item_l">{notempty name="$addonFieldExtList.level.ifrequire"}<b>*</b>{/notempty}{$addonFieldExtList['level']['title']}：</div>
            <div class="item_r">
                <select  name="addonFieldSys[{$addonFieldExtList['level']['name']|default=''}]">
                    {volist name="$addonFieldExtList['level']['dfvalue']" id="v2"}
                    <option value="{$v2}" {if condition="isset($addonFieldExtList['level']['trueValue']) AND in_array($v2, $addonFieldExtList['level']['trueValue'])"}selected{/if}>{$v2}</option>
                    {/volist}
                </select>
            </div>
        </div>
        {/notempty}
        {notempty name="$addonFieldExtList['manage_type']['ifeditable']"}
        <div class="item">
            <div class="item_l">{notempty name="$addonFieldExtList.manage_type.ifrequire"}<b>*</b>{/notempty}{$addonFieldExtList['manage_type']['title']}：</div>
            <div class="item_r">
                <select  name="addonFieldSys[{$addonFieldExtList['manage_type']['name']|default=''}]">
                    {volist name="$addonFieldExtList['manage_type']['dfvalue']" id="v2"}
                    <option value="{$v2}" {if condition="isset($addonFieldExtList['manage_type']['trueValue']) AND in_array($v2, $addonFieldExtList['manage_type']['trueValue'])"}selected{/if}>{$v2}</option>
                    {/volist}
                </select>
            </div>
        </div>
        {/notempty}
        {notempty name="$addonFieldExtList['division']['ifeditable']"}
        <div class="item">
            <div class="item_l">{notempty name="$addonFieldExtList.division.ifrequire"}<b>*</b>{/notempty}{$addonFieldExtList['division']['title']}：</div>
            <div class="item_r">
                <select  name="addonFieldSys[{$addonFieldExtList['division']['name']|default=''}]">
                    {volist name="$addonFieldExtList['division']['dfvalue']" id="v2"}
                    <option value="{$v2}" {if condition="isset($addonFieldExtList['division']['trueValue']) AND in_array($v2, $addonFieldExtList['division']['trueValue'])"}selected{/if}>{$v2}</option>
                    {/volist}
                </select>
            </div>
        </div>
        {/notempty}
        {notempty name="$addonFieldExtList['manage_type']['ifeditable']"}
        <div class="item">
            <div class="item_l">{notempty name="$addonFieldExtList.manage_type.ifrequire"}<b>*</b>{/notempty}{$addonFieldExtList['manage_type']['title']}：</div>
            <div class="item_r">
                <select  name="addonFieldSys[{$addonFieldExtList['manage_type']['name']|default=''}]">
                    {volist name="$addonFieldExtList['manage_type']['dfvalue']" id="v2"}
                    <option value="{$v2}" {if condition="isset($addonFieldExtList['manage_type']['trueValue']) AND in_array($v2, $addonFieldExtList['manage_type']['trueValue'])"}selected{/if}>{$v2}</option>
                    {/volist}
                </select>
            </div>
        </div>
        {/notempty}
        {notempty name="$addonFieldExtList['characteristic']['ifeditable']"}
        <div class="item">
            <div class="item_l">{notempty name="$addonFieldExtList.characteristic.ifrequire"}<b>*</b>{/notempty}{$addonFieldExtList['characteristic']['title']}：</div>
            <div class="item_r ">
                {volist name="$addonFieldExtList['characteristic']['dfvalue']" id="v2"}
                <span class="mr10"><input type="checkbox"  onclick="checkbox_is_empty('addonFieldSys','characteristic');" name="addonFieldSys[characteristic][]"  {if condition="isset($addonFieldExtList['characteristic']['trueValue']) AND in_array($v2, $addonFieldExtList['characteristic']['trueValue'])"}checked="checked"{/if} value="{$v2}"/>{$v2}</span>
                {/volist}
                <input type="hidden" name="addonFieldSys[characteristic_eyempty]" value="{if condition="!empty($addonFieldExtList['characteristic']['trueValue'])"}1{else /}0{/if}">
            </div>
        </div>
        {/notempty}
        {notempty name="$addonFieldExtList['supporting']['ifeditable']"}
        <div class="item">
            <div class="item_l">{notempty name="$addonFieldExtList.supporting.ifrequire"}<b>*</b>{/notempty}{$addonFieldExtList['supporting']['title']}：</div>
            <div class="item_r ">
                {volist name="$addonFieldExtList['supporting']['dfvalue']" id="v2"}
                <span class="mr10"><input type="checkbox"  onclick="checkbox_is_empty('addonFieldExt','supporting');" name="addonFieldExt[supporting][]"  {if condition="isset($addonFieldExtList['supporting']['trueValue']) AND in_array($v2, $addonFieldExtList['supporting']['trueValue'])"}checked="checked"{/if} value="{$v2}"/>{$v2}</span>
                {/volist}
                <input type="hidden" name="addonFieldExt[supporting_eyempty]" value="{if condition="!empty($addonFieldExtList['supporting']['trueValue'])"}1{else /}0{/if}">
            </div>
        </div>
        {/notempty}
        {notempty name="$addonFieldExtList['industry']['ifeditable']"}
        <div class="item">
            <div class="item_l">{notempty name="$addonFieldExtList.industry.ifrequire"}<b>*</b>{/notempty}{$addonFieldExtList['industry']['title']}：</div>
            <div class="item_r ">
                {volist name="$addonFieldExtList['industry']['dfvalue']" id="v2"}
                <span class="mr10"><input type="checkbox" onclick="checkbox_is_empty('addonFieldExt','industry');" name="addonFieldExt[industry][]" {if condition="isset($addonFieldExtList['industry']['trueValue']) AND in_array($v2, $addonFieldExtList['industry']['trueValue'])"}checked="checked"{/if} value="{$v2}"/>{$v2}</span>
                {/volist}
                <input type="hidden" name="addonFieldExt[industry_eyempty]" value="{if condition="!empty($addonFieldExtList['industry']['trueValue'])"}1{else /}0{/if}">

            </div>
        </div>
        {/notempty}
        {include file="users/addonextitem" /}
    </div>
    <div class="footer-bt">
        <input type="hidden" name="aid" value="{$aid}">
        <a href="javascript:;" onclick="submit_fun()">确认提交</a>
    </div>
</form>


<script>
    $(document).ready(function(){
        var city_id = "{$field.city_id}";
        set_city_list(city_id);
        var area_id = "{$field.area_id}";
        set_area_list(area_id);
    });
    //光标离开楼盘地址编辑，自动获取坐标
    $("#address").on('blur',function(){
        var province_id = $("#province_id").val(),city_id = $("#city_id").val(),area_id = $("#area_id").val();
        var address = $(this).val();
        var url     = "{:url('home/Map/getLocationByAddress')}";
        var param = {
            province : province_id,
            city : city_id,
            area : area_id,
            address : address
        };
        $.get(url,param,function(res){
            if(res.code == 1)
            {
                $("#map").val(res.data.map);
            }
        });
    });
    var layui_index = layui.config({
        base: '__SKIN__/' //静态资源所在路径
        ,version: '{$version}'
    }).extend({
        index: 'lib/index' //主入口模块
    }).use(['index', 'form'], function(){
        var $ = layui.$
            ,element = layui.element
            ,layer = layui.layer
            ,form = layui.form;

        element.render();
        //监听提交
        form.on('submit(formSubmit)', function(data){
            var load = layer_loading();
            data.field._ajax = 1;
            $('textarea[class*="ckeditor"]').each(function(index, item){
                data.field[item.name] = item.value;
            });
            $.ajax({
                type : 'post',
                url : "{:url('Officecz/edit')}",
                data : data.field,
                dataType : 'json',
                success : function(res){
                    layer.close(load); //关闭loading
                    if(res.code == 1){
                        parent.window.location.href = res.url;
                    }else{
                        layer.msg(res.msg, {icon: 2,time: 2000});
                    }
                },
                error: function(e){
                    layer.close(load); //关闭loading
                    showErrorAlert();
                }
            });
            return false;
        });

    });
    //提交
    function submit_fun(){
        var load = layer_loading();
        $.ajax({
            type : 'post',
            url : "{:url('Officecz/edit')}",
            data : $("#post_form").serialize(),
            dataType : 'json',
            success : function(res){
                layer.close(load); //关闭loading
                if(res.code == 1){
                    parent.window.location.href = res.url;
                }else{
                    layer.msg(res.msg, {icon: 2,time: 2000});
                }
            },
            error: function(e){
                layer.close(load); //关闭loading
                showErrorAlert();
            }
        });
        return false;
    }
    //选择省份
    function province_ch(){
        set_city_list(0);
        set_area_list(0);
    }
    //选择城市
    function city_ch(){
        set_area_list(0);
    }
    //标注地图位置
    function set_map()
    {
        var province = $("#province_id").val();
        var city = $("#city_id").val();
        var area = $("#area_id").val();
        if(city==='0' || city === '' || city === null)
        {
            layer.msg('请选择城市',{icon:2});
            return false;
        }
        var map = $("#map").val();
        var url = "{:url('home/Map/updateLocation')}&province="+province+"&city="+city+"&area="+area+"&map="+map;
        //iframe窗
        var iframes = layer.open({
            type: 2,
            title: '标注地图',
            fixed: true, //不固定
            shadeClose: false,
            shade: 0.3,
            content: url
        });
        layer.full(iframes);
    }
    //自动获取城市列表
    function set_city_list(cityid) {
        var pid =  $("#province_id").val();
        $.ajax({
            url: "{:url('Archives/ajax_get_region')}",
            type: 'POST',
            dataType: 'JSON',
            async: false,
            data: {pid:pid,_ajax:1},
            success: function(res){
                if (res.code === 1){
                    $("#city_id").empty();
                    $("#city_id").prepend(res.msg);
                    if (cityid > 0){
                        $("#city_id").val(cityid);
                    }
                }
            },
            error: function(e){
                showErrorMsg();
                return false;
            }
        });
    }
    //自动获取区域
    function set_area_list(areaid) {
        var pid =  $("#city_id").val();
        $.ajax({
            url: "{:url('Archives/ajax_get_region')}",
            type: 'POST',
            dataType: 'JSON',
            async: false,
            data: {pid:pid,level:3,_ajax:1},
            success: function(res){
                if (res.code === 1){
                    $("#area_id").empty();
                    $("#area_id").prepend(res.msg);
                    if (areaid > 0){
                        $("#area_id").val(areaid);
                    }
                    if (res.data.isempty == 1){
                        $("#area_div").hide();
                    }else{
                        $("#area_div").show();
                    }
                }
            },
            error: function(e){
                showErrorMsg();
                return false;
            }
        });
    }
    //上传相册前判断
    function ershou_photo_upload(){
        return true;
    }
    // 上传之后删除组图input
    function ClearPicArr(obj,path)
    {
        $(obj).parent().remove(); // 删除完服务器的, 再删除 html上的图片
        $.ajax({
            type:'POST',
            url:"{:url('Uploadify/delupload')}",
            data:{action:"del", filename:path},
            success:function(){}
        });
    }
    // 查看大图
    function Images(links){
        var max_width = 650;
        var max_height = 350;
        var img = "<img src='"+links+"'/>";
        $(img).load(function() {
            width  = this.width;
            height = this.height;
            if (width > height) {
                if (width > max_width) {
                    width = max_width;
                }
                width += 'px';
            } else {
                width = 'auto';
            }
            if (width < height) {
                if (height > max_height) {
                    height = max_height;
                }
                height += 'px';
            } else {
                height = 'auto';
            }
            var links_img = "<img style='width:"+width+";height:"+height+";' src="+links+">";
            layer.open({
                type: 1,
                title: false,
                closeBtn: true,
                shadeClose:true,
                area: [width, height],
                skin: 'layui-layer-nobg', //没有背景色
                content: links_img
            });
        });
    }
    // 图集相册的拖动排序相关 js
    $( ".sort-list" ).sortable({
        start: function( event, ui) {
        }
        ,stop: function( event, ui ) {
        }
    });
    $( ".sort-list" ).disableSelection();

    // 上传图集相册回调函数
    function ershou_photo_upload_call_back(pathObj){
        if (Array.isArray(pathObj)){
            var paths = pathObj;
        }else{
            var paths = [pathObj.url];
        }
        var last_div = $(".images_upload_tpl").html();
        for (var i=0;i<paths.length ;i++){
            $(".images-upload:eq(0)").before(last_div);  // 插入一个 新图片
            // 修改他的链接地址
            $(".images-upload:eq(0)").find('span:eq(0)').attr('onclick',"Images('"+paths[i]+"');");
            // 修改他的图片路径
            $(".images-upload:eq(0)").find('img').attr('src',paths[i]);
            // 处理图片路径及隐藏域
            $(".images-upload:eq(0)").find('input:eq(0)').attr('name','photo_id[]').attr('value','');
            $(".images-upload:eq(0)").find('input:eq(1)').attr('name','photo_pic[]').attr('value',paths[i]);
            $(".images-upload:eq(0)").find('input:eq(2)').attr('name','photo_title[]').attr('value','');
            $(".images-upload:eq(0)").find('a:eq(0)').attr('onclick',"ClearPicArr(this,'"+paths[i]+"')").html("删除");
        }
    }

</script>


<script type="text/javascript">
    //点击展开更多添加项
    $(".more-down").click(function(){
        $(".fang_more").toggle();
        if($(this).text() == "【点击展开】选填部分，建议填写"){
            $(this).text("【点击隐藏】选填部分，建议填写")
        }else{
            $(this).text("【点击展开】选填部分，建议填写")
        }
    })
</script>




</body>
</html>
