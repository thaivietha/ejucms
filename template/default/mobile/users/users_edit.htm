<!DOCTYPE html>
<html lang="zh-CN">
{include file="users/header" /}
<body style="padding-top:2.625rem ;">
<!--顶部-->
{include file="users/rightNav" /}
<form id="post_form" action="{:url('Users/edit')}" onsubmit="return false;">
<!--用户设置-->
<div class="fang_add mt10">
    <div class="item" >
        <div class="item_l">上传头像：</div>
        <div class="item_r">
            <div class="upload">
                <!--<input type="file" name="" id="" value="" />-->
                <span class="upload_bt test-upload-demoMore" lay-data="{number:1,ey_inputId:'litpic',ey_savepath:'allimg'}">上传头像</span>
            </div>
            <div class="upload-img">
                <div class="item-img">
                    <img id="img_litpic" src="{$field.litpic|get_default_pic=###}" >
                    <!--<a href="javascript:void(0);" onclick="ClearPicArr(this,'{$field.litpic|get_default_pic=###}')">删除</a>-->
                    <input type="hidden" name="litpic" id="litpic" placeholder="图片地址" value="{$field.litpic|default=''}" class="layui-input">
                </div>
            </div>
        </div>
    </div>
    <div class="item">
        <div class="item_l">真实姓名：</div>
        <div class="item_r">
            <input type="text" name="true_name" value="{$field.true_name}" placeholder="请输入姓名" />
        </div>
    </div>
    <div class="item">
        <div class="item_l">昵称：</div>
        <div class="item_r">
            <input type="text" name="nickname" value="{$field.nickname}" placeholder="请输入昵称" />
        </div>
    </div>
    <div class="item">
        <div class="item_l">QQ号：</div>
        <div class="item_r">
            <input type="text" name="qq" value="{$field.qq}" placeholder="请输入QQ号" />
        </div>
    </div>

</div>
<!--确认提交-->
<div class="footer-bt">
    <input type="hidden" name="id" value="{$field.users_id}">
    <a href="JavaScript:;"  onclick="submit_fun()">保存修改</a>
</div>
</form>
<script>
    //提交
    function submit_fun(){
        var load = layer_loading();
        $.ajax({
            type : 'post',
            url : "{:url('Users/edit')}",
            data : $("#post_form").serialize(),
            dataType : 'json',
            success : function(res){
                layer.close(load); //关闭loading
                if(res.code == 1){
                    layer.msg(res.msg, {icon: 1,time: 2000});
                    parent.window.location.href = "{:url('Users/centre')}";
                }else{
                    layer.msg(res.msg, {icon: 2,time: 2000});
                }
            },
            error: function(e){
                layer.close(load); //关闭loading
                showErrorAlert();
            }
        });
        return false;
    }
    function ClearPicArr(obj,path)
    {
        $(obj).parent().remove(); // 删除完服务器的, 再删除 html上的图片
        $.ajax({
            type:'POST',
            url:"{:url('Uploadify/delupload')}",
            data:{action:"del", filename:path},
            success:function(){}
        });
    }
</script>


</body>
</html>
