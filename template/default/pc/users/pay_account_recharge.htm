<!DOCTYPE html>
<html>
{include file="users/public_layout" /}
<body>

<div class="layui-fluid " id="LAY-component-layer-list">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12">
            <div class="layui-card">
                <div class="layui-tab layui-tab-card">
                    <div class="bt-close">
                        <span class="layui-layer-setwin"><a onclick="close_this();" class="layui-layer-ico layui-layer-close layui-layer-close1"></a></span>
                    </div>
                    <ul class="layui-tab-title">
                        <li class="layui-this">账户充值</li>
                    </ul>
                </div>
                <div class="layui-card-body layui-form house-form" wid100>
                    <div class="layui-form-item"></div>

                    <div class="layui-form-item">
                        <label class="layui-form-label">账户余额</label>
                        <div class="layui-input-inline">
                            <span class="fl info-text">￥{$users.users_money}元</span>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">充值金额 : </label>
                        <div class="layui-input-inline">
                             <span style="l ine-height: 33px;float: left;">￥</span>
                            <input  type="text" name="money" value="{$money}" class="layui-input" onkeyup="this.value=this.value.replace(/[^0-9\.]/g,'')" onafterpaste="this.value=this.value.replace(/[^0-9\.]/g,'')" style="width:25%;float: left;">
                            <span style="line-height: 33px;">元</span>
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <div class="layui-input-block">
                            <input type="hidden" name="unified_number" value="{$unified_number}">
                            <button class="layui-btn"  lay-submit lay-filter="formSubmit">去付款</button>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<script>
    layui.config({
        base: '__SKIN__/' //静态资源所在路径
        ,version: '{$version}'
    }).extend({
        index: 'lib/index' //主入口模块
    }).use(['index', 'form',  'upload'], function(){
        var $ = layui.$
            ,upload = layui.upload
            ,form = layui.form;

        //监听提交
        form.on('submit(formSubmit)', function(data){
            var money = $('input[name=money]');
            if($.trim(money.val()) == ''){
                layer.msg('充值金额不能为空！', {icon: 2, time: 1000});
                money.focus();
                return false;
            } else if(isNaN($.trim(money.val()))){
                layer.msg('请输入正确的充值金额！', {icon: 2, time: 1000});
                money.focus();
                return false;
            }
            var load = layer_loading();
            data.field._ajax = 1;
            $.ajax({
                type : 'post',
                url : "{:url('user/Pay/pay_account_recharge')}",
                data : data.field,
                dataType : 'json',
                success : function(res){
                    layer.close(load); //关闭loading
                    if (res.code == 1) {
                        if (0 == res.data.is_gourl) {
                            $('#unified_number').val(res.data.unified_number);
                            $('#transaction_type').val(res.data.transaction_type);
                            WeChatInternal(res.data);
                        }else{
                            window.location.href = res.url;
                        }
                    }else{
                        layer.closeAll();
                        layer.alert(res.msg, {icon: 2});
                    }
                },
                error: function(e){
                    layer.close(load); //关闭loading
                    showErrorAlert();
                }
            });
            return false;
        });

    });

</script>

</body>
</html>