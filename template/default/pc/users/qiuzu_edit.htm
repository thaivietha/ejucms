<!DOCTYPE html>
<html>
{include file="users/public_layout" /}
<body>
<script type="text/javascript" src="__PUBLIC__/plugins/Ueditor/ueditor.config.js?v={$version}"></script>
<script type="text/javascript" src="__PUBLIC__/plugins/Ueditor/ueditor.all.js?v={$version}"></script>
<script type="text/javascript" src="__PUBLIC__/plugins/Ueditor/lang/zh-cn/zh-cn.js?v={$version}"></script>
<style type="text/css">
    .input_div{
        background-color: #fff;
        position:absolute;
        z-index: 999;
        width: 100%;
        box-shadow: 1px 2px 4px rgba(50, 50, 50, 0.4);
        display: block;
    }
    .input_div .soption{
        float: left;
        width: 92%;
        line-height: 26px;
        padding:0 4%;
        display:block;
    }
    .input_div .soption:hover{
        background-color: #eee;
    }
</style>
<div class="layui-fluid" id="LAY-component-layer-list">
    <div class="layui-row">
        <div class="layui-col-md12">
            <div class="layui-card">
                <div class="">
                    <form class="layui-form" id="post_form" action="{:url('Qiuzu/edit')}" onsubmit="return false;">
                        <div class="bt-close">
                            <span class="layui-layer-setwin"><a onclick="close_this();" class="layui-layer-ico layui-layer-close layui-layer-close1"></a></span>
                        </div>
                        <div class="layui-tab layui-tab-card">
                            <ul class="layui-tab-title">
                                <li class="layui-this">基本信息</li>
                            </ul>
                            <div class="layui-tab-content web-system" style="padding:0 0 40px 0">
                                <!--基本信息-->
                                <div class="layui-tab-item layui-show">

                                    <div class="layui-row layui-col-space15">
                                        <div class="layui-row w-max" style="padding-top: 20px;">
                                            <div class="layui-card">
                                                <div class="layui-card-body" pad15="">
                                                    <div class="layui-form" wid100="" lay-filter="">
                                                        {notempty name="$channelJoin"}
                                                        <div class="layui-form-item">
                                                            <label class="layui-form-label">{notempty name="$channelOrigin.join_must"}<b>*</b>{/notempty}关联{$channelJoin.ntitle}</label>
                                                            <div class="layui-input-inline w-in">
                                                                <input type="hidden" id="joinaid" name="joinaid" value="" />
                                                                <input type="text" name="join_title" id="join_title"  placeholder="丰祥花苑"  value="" class="layui-input">
                                                                <div class="input_div" id="input_div" style="display: none">
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <script>
                                                            var data_obj;
                                                            $(function (){
                                                                var searchurl = "{$searchurl}";
                                                                autoSearch("join_title");
                                                                function autoSearch(searchId) {
                                                                    $("#" + searchId).autocomplete({
                                                                        delay:300,      //触发时间
                                                                        minLength:1,    //最小触发长度
                                                                        source: function (request, response) {
                                                                            $.ajax({
                                                                                async: false,   //调用方式：同步
                                                                                type: "POST",
                                                                                url: searchurl,
                                                                                dataType: "json",
                                                                                data: {
                                                                                    "keywords": request.term
                                                                                },
                                                                                success: function (data) {
                                                                                    if (data.constructor === Object){
                                                                                        data_obj = data;
                                                                                        $.map(data,function (item,i) {
                                                                                            var span = $('<span onclick="select_soption(this)" class="soption" data-id="'+i+'">'+item.title+'</span>');
                                                                                            $(".input_div").append(span);
                                                                                        });
                                                                                        $(".input_div").show();
                                                                                    }else{      //获取到空数据
                                                                                        $(".input_div").hide();
                                                                                    }
                                                                                }
                                                                                ,error:function (data) {
                                                                                }
                                                                            });
                                                                        }
                                                                    });
                                                                }
                                                            });
                                                            function select_soption(obj) {
                                                                var aid = $(obj).data('id');
                                                                $("#joinaid").val(aid);
                                                                $("#title").val(data_obj[aid]['title']);
                                                                $("#join_title").val(data_obj[aid]['title']);
                                                                $("#province_id").val(data_obj[aid]['province_id']);
                                                                $("#city_id").val(data_obj[aid]['city_id']);
                                                                $("#area_id").val(data_obj[aid]['area_id']);
                                                                var map = "";
                                                                if (data_obj[aid]['lng'] && data_obj[aid]['lat']){
                                                                    map =  data_obj[aid]['lng']+","+data_obj[aid]['lat'];
                                                                }
                                                                $("#map").val(map);
                                                                $("#address").val(data_obj[aid]['address']);
                                                                $("#building_age").val(data_obj[aid]['building_age']);
                                                                $("#property").val(data_obj[aid]['property']);
                                                                $("#input_div").empty();
                                                                $("#input_div").hide();
                                                                set_city_list(data_obj[aid]['city_id']);
                                                                set_area_list(data_obj[aid]['area_id']);
                                                                layui_index.form.render();
                                                            }
                                                        </script>
                                                        {/notempty}

                                                        <div class="layui-form-item">
                                                            <label class="layui-form-label">{notempty name="$addonFieldExtList.province_id.ifrequire"}<b>*</b>{/notempty}期望区域</label>
                                                            <div class="layui-input-inline w120">
                                                                <select name="province_id" id="province_id"  lay-filter="province_id" >
                                                                    <option value="0">请选择省</option>
                                                                    {eju:volist name=':get_province_list()' id='vo'}
                                                                    <option value="{$vo.id}" {eq name="$field.province_id" value="$vo.id" } selected {/eq} >{$vo.name}</option>
                                                                    {/eju:volist}
                                                                </select>
                                                            </div>
                                                            <div class="layui-input-inline w120">
                                                                <select name="city_id" id="city_id"   lay-filter="city_id" >
                                                                    <option value="">请选择城市</option>
                                                                </select>
                                                            </div>
                                                            <div class="layui-input-inline none w120" id="area_div">
                                                                <select name="area_id" id="area_id">
                                                                    <option value="">请选择区域</option>
                                                                </select>
                                                            </div>
                                                            <div class="layui-form-mid layui-word-aux ey_helptips"></div>
                                                            <div class="layui-form-inline2 ey_helptips_txt none"></div>
                                                        </div>
                                                        <div class="w-out fl mt15">
                                                            <label class="layui-form-label">{notempty name="$addonFieldExtList.manage_type.ifrequire"}<b>*</b>{/notempty}{$addonFieldExtList['manage_type']['title']}</label>
                                                            <div class="layui-input-inline w-in" >
                                                                <div class="layui-input-inline " >
                                                                    <select name="addonFieldSys[manage_type]" id="manage_type" >
                                                                        {volist name="$addonFieldExtList['manage_type']['dfvalue']" id="v2"}
                                                                        <option value="{$v2}" {if condition="isset($addonFieldExtList['manage_type']['trueValue']) AND in_array($v2, $addonFieldExtList['manage_type']['trueValue'])"}selected{/if}>{$v2}</option>
                                                                        {/volist}
                                                                    </select>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="w-out fl mt15">
                                                            <label class="layui-form-label">{notempty name="$addonFieldExtList.shop_type.ifrequire"}<b>*</b>{/notempty}{$addonFieldExtList['shop_type']['title']}</label>
                                                            <div class="layui-input-inline w-in" >
                                                                <div class="layui-input-inline " >
                                                                    <select name="addonFieldSys[shop_type]" id="shop_type" >
                                                                        {volist name="$addonFieldExtList['shop_type']['dfvalue']" id="v2"}
                                                                        <option value="{$v2}" {if condition="isset($addonFieldExtList['shop_type']['trueValue']) AND in_array($v2, $addonFieldExtList['shop_type']['trueValue'])"}selected{/if}>{$v2}</option>
                                                                        {/volist}
                                                                    </select>
                                                                </div>
                                                            </div>
                                                        </div>




                                                        <div class="w-out fl mt15 {empty name="$addonFieldExtList['sale_name']['ifeditable']"}none{/empty}">
                                                        <label class="layui-form-label">{notempty name="$addonFieldExtList.sale_name.ifrequire"}<b>*</b>{/notempty}{$addonFieldExtList['sale_name']['title']}</label>
                                                        <div class="layui-input-inline w-in">
                                                            <input type="text" name="addonFieldSys[sale_name]" id="sale_name" value="{$users.true_name}"   placeholder="{$addonFieldExtList['sale_name']['remark']}" class="layui-input">
                                                        </div>
                                                        <div class="layui-input-inline layui-input-company">{$addonFieldExtList['sale_name']['dfvalue_unit']}</div>
                                                    </div>
                                                    <div class="w-out fl mt15 {empty name="$addonFieldExtList['sale_phone']['ifeditable']"}none{/empty}">
                                                    <label class="layui-form-label">{notempty name="$addonFieldExtList.sale_phone.ifrequire"}<b>*</b>{/notempty}{$addonFieldExtList['sale_phone']['title']}</label>
                                                    <div class="layui-input-inline w-in">
                                                        <div class="layui-input-inline w150">
                                                            <input type="text" name="addonFieldSys[sale_phone]" id="sale_phone"  placeholder="{$addonFieldExtList['sale_phone']['remark']}" value="{$users.mobile}" class="layui-input" onkeyup="this.value=this.value.replace(/[^0-9-]/g,'');" onpaste="this.value=this.value.replace(/[^0-9-]/g,'');">
                                                        </div>
                                                        <div class="layui-input-inline w20">
                                                            转
                                                        </div>
                                                        <div class="layui-input-inline w80 {empty name="$addonFieldExtList['phone_code']['ifeditable']"}none{/empty}">
                                                        <input type="text" name="addonFieldSys[phone_code]" id="phone_code"  placeholder="{$addonFieldExtList['phone_code']['remark']}" value="{$addonFieldExtList['phone_code']['dfvalue']}" class="layui-input">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="w-out fl mt15 {empty name="$addonFieldExtList['lease']['ifeditable']"}none{/empty}">
                                            <label class="layui-form-label">{notempty name="$addonFieldExtList.lease.ifrequire"}<b>*</b>{/notempty}{$addonFieldExtList['lease']['title']}</label>
                                            <div class="layui-input-inline w-in">
                                                <input type="text"  name="addonFieldExt[lease]" id="lease" value="{$addonFieldExtList['lease']['dfvalue']}" class="layui-input">
                                            </div>
                                            <div class="layui-input-inline layui-input-company">{$addonFieldExtList['lease']['dfvalue_unit']}</div>
                                        </div>
                                        <div class="w-out fl mt15 {empty name="$addonFieldExtList['certificate']['ifeditable']"}none{/empty}">
                                        <label class="layui-form-label">{notempty name="$addonFieldExtList.certificate.ifrequire"}<b>*</b>{/notempty}{$addonFieldExtList['certificate']['title']}</label>
                                        <div class="layui-input-inline w-in">
                                            <input type="text" name="addonFieldExt[certificate]" id="certificate" value="{$addonFieldExtList['certificate']['dfvalue']}"  placeholder="{$addonFieldExtList['certificate']['remark']}" class="layui-input">
                                        </div>
                                        <div class="layui-input-inline layui-input-company">
                                            {$addonFieldExtList['certificate']['dfvalue_unit']}
                                        </div>
                                    </div>
                                    <div class="w-out fl mt15 {empty name="$addonFieldExtList['floors']['ifeditable']"}none{/empty}">
                                    <label class="layui-form-label">{notempty name="$addonFieldExtList.floors.ifrequire"}<b>*</b>{/notempty}{$addonFieldExtList['floors']['title']}</label>
                                    <div class="layui-input-inline w-in">
                                        <input type="text" name="addonFieldExt[floors]" id="floors" value="{$addonFieldExtList['floors']['dfvalue']}"  placeholder="{$addonFieldExtList['floors']['remark']}" class="layui-input">
                                    </div>
                                    <div class="layui-input-inline layui-input-company">
                                        {$addonFieldExtList['floors']['dfvalue_unit']}
                                    </div>
                                </div>
                            </div>
                        </div>
                </div>
            </div>

            <div class="layui-col-md12" style="padding-top: 0px;">
                <div class="layui-card" style="">
                    <div class="layui-card-body" pad15="" style="padding-top: 0px;">
                        <div class="layui-form" wid100="" lay-filter="" style="">

                            <div class="layui-form-item">
                                <label class="layui-form-label">{notempty name="$addonFieldExtList.area_min.ifrequire"}<b>*</b>{/notempty}意向面积</label>
                                <div class="layui-input-inline w-max2">
                                    <div class="layui-input-inline2 w200">
                                        <select name="addonFieldSys[area]" id="area"  lay-filter="area">
                                            <option value="">请选择</option>
                                            {volist name=":get_qiuzu_area_list()" id="v2"}
                                            <option value="{$v2.value}" {if condition="isset($addonFieldExtList['area_min']['dfvalue']) AND ($v2['min'] eq $addonFieldExtList['area_min']['dfvalue']) AND isset($addonFieldExtList['area_max']['dfvalue']) AND ($v2['max'] eq $addonFieldExtList['area_max']['dfvalue'])"}selected{/if} >{$v2.name}</option>
                                            {/volist}
                                            <option value="0">其他</option>
                                        </select>
                                    </div>
                                    <div id="area_value_div" class="layui-input-inline2" style="display: none">
                                        <div class="layui-input-inline2 ">
                                            <input type="text" name="addonFieldSys[area_min]" id="area_min" value="{$addonFieldExtList['area_min']['dfvalue']}"  placeholder="{$addonFieldExtList['area_min']['remark']}" class="layui-input">
                                        </div>
                                        --
                                        <div class="layui-input-inline2 ">
                                            <input type="text" name="addonFieldSys[area_max]" id="area_max" value="{$addonFieldExtList['area_max']['dfvalue']}"  placeholder="{$addonFieldExtList['area_max']['remark']}" class="layui-input">
                                        </div>
                                        {$addonFieldExtList['area_max']['dfvalue_unit']}
                                    </div>
                                </div>
                            </div>

                            <div class="layui-form-item">
                                <label class="layui-form-label">{notempty name="$addonFieldExtList.price_min.ifrequire"}<b>*</b>{/notempty}意向租金</label>
                                <div class="layui-input-inline w-max2">
                                    <div class="layui-input-inline2 w120 {empty name="$addonFieldExtList['price_type']['ifeditable']"}none{/empty}" >
                                    <select name="addonFieldSys[price_type]" id="price_type" lay-filter="price_type">
                                        <option value="">请选择</option>
                                        {volist name="$addonFieldExtList['price_type']['dfvalue']" id="v2"}
                                        <option value="{$v2}" {if condition="isset($addonFieldExtList['price_type']['trueValue']) AND in_array($v2, $addonFieldExtList['price_type']['trueValue'])"}selected{/if}>{$v2}</option>
                                        {/volist}
                                    </select>
                                </div>
                                <div class="layui-input-inline2 w200" id="price_select_div"  style="display: none">
                                    <select name="addonFieldSys[price]" id="price"  lay-filter="price">
                                        <option value="">请选择</option>
                                        {volist name=":get_qiuzu_price_list()" id="v2"}
                                        <option value="{$v2.value}" {if condition="isset($addonFieldExtList['price_min']['dfvalue']) AND ($v2['min'] eq $addonFieldExtList['price_min']['dfvalue']) AND isset($addonFieldExtList['price_max']['dfvalue']) AND ($v2['max'] eq $addonFieldExtList['price_max']['dfvalue'])"}selected{/if}>{$v2.name}</option>
                                        {/volist}
                                        <option value="0" >其他</option>

                                    </select>
                                </div>
                                <div id="price_value_div" class="layui-input-inline2"  style="display: none">
                                    <div class="layui-input-inline2 ">
                                        <input type="text" name="addonFieldSys[price_min]" id="price_min" value="{$addonFieldExtList['price_min']['dfvalue']}"  placeholder="{$addonFieldExtList['price_min']['remark']}" class="layui-input">
                                    </div>
                                    --
                                    <div class="layui-input-inline2" >
                                        <input type="text" name="addonFieldSys[price_max]" id="price_max" value="{$addonFieldExtList['price_max']['dfvalue']}"  placeholder="{$addonFieldExtList['price_max']['remark']}" class="layui-input">
                                    </div>
                                </div>
                                <div class="layui-input-inline2 w120 {empty name="$addonFieldExtList['price_units']['ifeditable']"}none{/empty}" >
                                <select name="addonFieldSys[price_units]" id="price_units">
                                    {volist name="$addonFieldExtList['price_units']['dfvalue']" id="v2"}
                                    <option value="{$v2}" {if condition="isset($addonFieldExtList['price_units']['trueValue']) AND in_array($v2, $addonFieldExtList['price_units']['trueValue'])"}selected{/if}>{$v2}</option>
                                    {/volist}
                                </select>
                            </div>
                        </div>
                    </div>


                    <div class="layui-form-item {empty name="$addonFieldExtList['transfer']['ifeditable']"}none{/empty}">
                    <label class="layui-form-label">{notempty name="$addonFieldExtList.transfer.ifrequire"}<b>*</b>{/notempty}{$addonFieldExtList['transfer']['title']}</label>
                    <div class="layui-input-inline w-max2">
                        {volist name="$addonFieldExtList['transfer']['dfvalue']" id="v2"}
                        <input type="radio" id="addonFieldSys_{$addonFieldExtList['transfer']['name']|default=''}" name="addonFieldSys[{$addonFieldExtList['transfer']['name']|default=''}]" value="{$v2}" {if condition="isset($addonFieldExtList['transfer']['trueValue']) AND in_array($v2, $addonFieldExtList['transfer']['trueValue'])"}checked="checked"{/if} title="{$v2}">
                        {/volist}
                    </div>
                </div>
                <div class="layui-form-item {empty name="$addonFieldExtList['supporting']['ifeditable']"}none{/empty}">
                <label class="layui-form-label">{notempty name="$addonFieldExtList.supporting.ifrequire"}<b>*</b>{/notempty}{$addonFieldExtList['supporting']['title']}</label>
                <div class="layui-input-inline w-max2">
                    {volist name="$addonFieldExtList['supporting']['dfvalue']" id="v2"}
                    <input type="checkbox" lay-skin="primary" name="addonFieldExt[supporting][]" {if condition="isset($addonFieldExtList['supporting']['trueValue']) AND in_array($v2, $addonFieldExtList['supporting']['trueValue'])"}checked="checked"{/if} value="{$v2}"  title="{$v2}">
                    {/volist}
                </div>
            </div>

            {include file="users/addonextitem" /}
            <div class="layui-form-item {empty name="$addonFieldExtList['content']['ifeditable']"}none{/empty}">
            <span class="edit-box-tit">{notempty name="$addonFieldExtList.content.ifrequire"}<b>*</b>{/notempty}{$addonFieldExtList['content']['title']}</span>
            <div class="edit-box-con ">
                <div class="edit-box-textarea2">
                    <textarea  class="ckeditor" lay-ignore id="addonFieldExt_content" data-func="addonFieldExt_content" name="addonFieldExt[content]"></textarea>
                </div>
            </div>
            <div class="layui-input-inline layui-btn-container " style="width: auto;">
                <div class="layui-form-mid layui-word-aux ey_helptips"></div>
                <div class="layui-form-inline2 ey_helptips_txt">{$addonFieldExtList['content']['remark']}</div>
            </div>
        </div>
        <script type="text/javascript">
            UE.getEditor('addonFieldExt_content',{
                serverUrl :"{:url('Ueditor/index',array('savepath'=>'ueditor'))}",
                zIndex: 999,
                initialFrameWidth: "100%", //初化宽度
                initialFrameHeight: 450, //初化高度
                focus: false, //初始化时，是否让编辑器获得焦点true或false
                maximumWords: 99999,
                removeFormatAttributes: 'class,style,lang,width,height,align,hspace,valign',//允许的最大字符数 'fullscreen',
                pasteplain:false, //是否默认为纯文本粘贴。false为不使用纯文本粘贴，true为使用纯文本粘贴
                autoHeightEnabled: false,
                toolbars: ueditor_toolbars,
                // xss 过滤是否开启,inserthtml等操作
                xssFilterRules: true,
                //input xss过滤
                inputXssFilter: true,
                //output xss过滤
                outputXssFilter: true
            });
            //必须在提交前渲染编辑器；
            function addonFieldExt_content() {
                //判断编辑模式状态:0表示【源代码】HTML视图；1是【设计】视图,即可见即所得；-1表示不可用
                if(UE.getEditor("addonFieldExt_content").queryCommandState('source') != 0) {
                    UE.getEditor("addonFieldExt_content").execCommand('source'); //切换到【设计】视图
                }
            }
        </script>
    </div>
</div>
</div>
</div>
</div>
</div>

</div>
</div>
<!--底部浮动横条-->
<div class="button-container layadmin-layer-demo">
    <input type="hidden" name="aid" value="{$aid}">
    <button class="layui-btn layui-btn-sm" lay-submit lay-filter="formSubmit">确认提交</button>
    <button class="layui-btn layui-btn-sm layui-btn-primary" data-type="return_parent">返回</button>
</div>
</form>
</div>
</div>
</div>
</div>
</div>
<script>
    $(document).ready(function(){
        // 鼠标事件，加载查看大图和删除图片
        $(".upload-img").live('mouseover', function(){
            $(this).find('div.icaction').show();
            $(this).find('div.cover-bg').show();
        }).live('mouseout', function(){
            $(this).find('div.icaction').hide();
            $(this).find('div.cover-bg').hide();
        });
        var city_id = "{$field.city_id}";
        set_city_list(city_id);
        var area_id = "{$field.area_id}";
        set_area_list(area_id);
        var area = "{$addonFieldExtList.area_min.dfvalue}" + "," + "{$addonFieldExtList.area_max.dfvalue}";
        area_value(area);
        price_select("{$addonFieldExtList.price_type.trueValue[0]}");
        var price = "{$addonFieldExtList.price_min.dfvalue}" + "," + "{$addonFieldExtList.price_max.dfvalue}";
        price_value(price);
    });
    //光标离开楼盘地址编辑，自动获取坐标
    $("#address").on('blur',function(){
        var province_id = $("#province_id").val(),city_id = $("#city_id").val(),area_id = $("#area_id").val();
        var address = $(this).val();
        var url     = "{:url('home/Map/getLocationByAddress')}";
        var param = {
            province : province_id,
            city : city_id,
            area : area_id,
            address : address
        };
        $.get(url,param,function(res){
            if(res.code == 1)
            {
                $("#map").val(res.data.map);
            }
        });
    });
    var layui_index = layui.config({
        base: '__SKIN__/' //静态资源所在路径
        ,version: '{$version}'
    }).extend({
        index: 'lib/index' //主入口模块
    }).use(['index', 'form'], function(){
        var $ = layui.$
            ,element = layui.element
            ,layer = layui.layer
            ,form = layui.form;

        element.render();
        /* 触发事件 */
        var active = {
            return_parent:function () {     //返回上级
                var index=parent.layer.getFrameIndex(window.name); //获取当前窗口的name
                parent.layer.close(index);		//关闭窗口
            }
            ,select_house:function () {     //小区关联管理
                var xinfang = layer.open({
                    type : 2,
                    title : '选择小区',
                    area : ['500px','500px'],
                    shade : 0.2,
                    iframeAuto:true,
                    content : "{:url('Xiaoqu/ajaxSelectHouse')}"+'&func=set_house_back',
                    end : function(){

                    }
                });
                layer.full(xinfang);
            }
            ,map_mark:function () {     //标注管理
                set_map();
            }
        };

        $('#LAY-component-layer-list .layadmin-layer-demo .layui-btn').on('click', function(){
            var type = $(this).data('type');
            active[type] && active[type].call(this);
        });

        //选中省份模型
        form.on('select(province_id)', function(data){
            set_city_list(0);
            set_area_list(0);
            form.render();
        });
        //选中城市
        form.on('select(city_id)', function(data){
            set_area_list(0);
            form.render();
        });
        //选择意向面积
        form.on('select(area)', function(data){
            if(data.value == '0'){
                $("#area_min").val("");
                $("#area_max").val("");
                $("#area_value_div").show();
            }else{
                var arr = data.value.split(',');
                $("#area_min").val(arr[0]);
                $("#area_max").val(arr[1]);
                $("#area_value_div").hide();
            }
            form.render();
        });
        //选择租金类型
        form.on('select(price_type)', function(data){
            if(data.value == '月租金'){
                $("#price_select_div").show();
                $("#price_value_div").hide();
            }else if(data.value == '日租金'){
                $("#price_select_div").hide();
                $("#price_value_div").show();
            }else{
                $("#price_select_div").hide();
                $("#price_value_div").hide();
            }

            form.render();
        });
        //选择租金范围
        form.on('select(price)', function(data){
            if(data.value == '0'){
                $("#price_min").val("");
                $("#price_max").val("");
                $("#price_value_div").show();
            }else{
                var arr = data.value.split(',');
                $("#price_min").val(arr[0]);
                $("#price_max").val(arr[1]);
                $("#price_value_div").hide();
            }
            form.render();
        });
        //监听提交
        form.on('submit(formSubmit)', function(data){
            var load = layer_loading();
            data.field._ajax = 1;
            $('textarea[class*="ckeditor"]').each(function(index, item){
                data.field[item.name] = item.value;
            });
            $.ajax({
                type : 'post',
                url : "{:url('Qiuzu/edit')}",
                data : data.field,
                dataType : 'json',
                success : function(res){
                    layer.close(load); //关闭loading
                    if(res.code == 1){
                        parent.window.location.href = res.url;
                    }else{
                        layer.msg(res.msg, {icon: 2,time: 2000});
                    }
                },
                error: function(e){
                    layer.close(load); //关闭loading
                    showErrorAlert();
                }
            });
            return false;
        });

    });
    //标注地图位置
    function set_map()
    {
        var province = $("#province_id").val();
        var city = $("#city_id").val();
        var area = $("#area_id").val();
        if(city==='0' || city === '' || city === null)
        {
            layer.msg('请选择城市',{icon:2});
            return false;
        }
        var map = $("#map").val();
        var url = "{:url('home/Map/updateLocation')}&province="+province+"&city="+city+"&area="+area+"&map="+map;
        //iframe窗
        var iframes = layer.open({
            type: 2,
            title: '标注地图',
            fixed: true, //不固定
            shadeClose: false,
            shade: 0.3,
            content: url
        });
        layer.full(iframes);
    }
    //自动获取城市列表
    function set_city_list(cityid) {
        var pid =  $("#province_id").val();
        $.ajax({
            url: "{:url('Archives/ajax_get_region')}",
            type: 'POST',
            dataType: 'JSON',
            async: false,
            data: {pid:pid,_ajax:1},
            success: function(res){
                if (res.code === 1){
                    $("#city_id").empty();
                    $("#city_id").prepend(res.msg);
                    if (cityid > 0){
                        $("#city_id").val(cityid);
                    }
                }
            },
            error: function(e){
                showErrorMsg();
                return false;
            }
        });
    }
    //自动获取区域
    function set_area_list(areaid) {
        var pid =  $("#city_id").val();
        $.ajax({
            url: "{:url('Archives/ajax_get_region')}",
            type: 'POST',
            dataType: 'JSON',
            async: false,
            data: {pid:pid,level:3,_ajax:1},
            success: function(res){
                if (res.code === 1){
                    $("#area_id").empty();
                    $("#area_id").prepend(res.msg);
                    if (areaid > 0){
                        $("#area_id").val(areaid);
                    }
                    if (res.data.isempty == 1){
                        $("#area_div").hide();
                    }else{
                        $("#area_div").show();
                    }
                }
            },
            error: function(e){
                showErrorMsg();
                return false;
            }
        });
    }
    //判断是否显示填空区域
    function area_value(data){
        if(data == '0'){
            $("#area_min").val("");
            $("#area_max").val("");
            $("#area_value_div").show();
        }else{
            var arr = data.split(',');
            $("#area_min").val(arr[0]);
            $("#area_max").val(arr[1]);
            $("#area_value_div").hide();
        }
    }
    function price_select(data){
        if(data == '月租金'){
            $("#price_select_div").show();
            $("#price_value_div").hide();
        }else if(data == '日租金'){
            $("#price_select_div").hide();
            $("#price_value_div").show();
        }else{
            $("#price_select_div").hide();
            $("#price_value_div").hide();
        }
    }
    function price_value(data){
        if(data == '0'){
            $("#price_min").val("");
            $("#price_max").val("");
            $("#price_value_div").show();
        }else{
            var arr = data.split(',');
            $("#price_min").val(arr[0]);
            $("#price_max").val(arr[1]);
            $("#price_value_div").hide();
        }
    }

    //上传相册前判断
    function qiuzu_photo_upload(){
        return true;
    }
    // 上传之后删除组图input
    function ClearPicArr(obj,path)
    {
        $(obj).parent().parent().remove(); // 删除完服务器的, 再删除 html上的图片
        $.ajax({
            type:'POST',
            url:"{:url('Uploadify/delupload')}",
            data:{action:"del", filename:path},
            success:function(){}
        });
    }
    // 查看大图
    function Images(links){
        var max_width = 650;
        var max_height = 350;
        var img = "<img src='"+links+"'/>";
        $(img).load(function() {
            width  = this.width;
            height = this.height;
            if (width > height) {
                if (width > max_width) {
                    width = max_width;
                }
                width += 'px';
            } else {
                width = 'auto';
            }
            if (width < height) {
                if (height > max_height) {
                    height = max_height;
                }
                height += 'px';
            } else {
                height = 'auto';
            }
            var links_img = "<img style='width:"+width+";height:"+height+";' src="+links+">";
            layer.open({
                type: 1,
                title: false,
                closeBtn: true,
                shadeClose:true,
                area: [width, height],
                skin: 'layui-layer-nobg', //没有背景色
                content: links_img
            });
        });
    }
    // 图集相册的拖动排序相关 js
    $( ".sort-list" ).sortable({
        start: function( event, ui) {
        }
        ,stop: function( event, ui ) {
        }
    });
    $( ".sort-list" ).disableSelection();

    // 上传图集相册回调函数
    function qiuzu_photo_upload_call_back(pathObj){
        if (Array.isArray(pathObj)){
            var paths = pathObj;
        }else{
            var paths = [pathObj.url];
        }
        var last_div = $(".images_upload_tpl").html();
        var inputs   = $('.span_input input');
        var photo_type = $("#photo_type_select").val();
        var photo_type_name = $("#photo_type_select").find("option:selected").text();
        for (var i=0;i<paths.length ;i++){
            $(".images-upload:eq(0)").before(last_div);  // 插入一个 新图片
            // 修改他的链接地址
            $(".images-upload:eq(0)").find('span:eq(0)').attr('onclick',"Images('"+paths[i]+"');");
            // 修改他的图片路径
            $(".images-upload:eq(0)").find('img').attr('src',paths[i]);
            // 处理图片路径及隐藏域
            if (inputs.length > '0') {
                // 修改隐藏域，提交ID隐藏域
                $(".images-upload:eq(0)").find('input:eq(0)').attr('name','photo_id[]').attr('value','');
                // 修改隐藏域，提交图片隐藏域
                $(".span_input:eq(0)").find('input:eq(0)').attr('name','photo_pic[]').attr('value',paths[i]);
                //修改隐藏域，提交图片类型 select_input
                $(".images-upload:eq(0)").find('input:eq(0)').attr('name','photo_type[]').attr('value',photo_type);
                // 提交标题
                $(".images-upload:eq(0)").find('textarea:eq(0)').attr('name','photo_title[]');
                // 删除按钮
                $(".images-upload:eq(0)").find('div.operation a:eq(0)').attr('onclick',"ClearPicArr(this,'"+paths[i]+"')").html("<i class='layui-icon layui-icon-close mr5'></i>删除");
            }
        }
    }

</script>
</body>
</html>
